<div class="table-responsive">
  <table class="table table-hover mb-0">
    <thead class="table-light">
      <tr>
        <% if show_rank %>
          <th>Rank</th>
        <% end %>
        <th>User</th>
        <% if show_error_type_count %>
          <th>Different Error Types</th>
        <% end %>
        <th>Error Count</th>
        <% if show_percentage %>
          <th>Percentage</th>
        <% end %>
        <% if show_error_types %>
          <th>Error Types</th>
        <% end %>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% users.each_with_index do |user_data, index| %>
        <tr>
          <% if show_rank %>
            <td><strong>#<%= index + 1 %></strong></td>
          <% end %>
          <td><%= user_data[:email] || user_data[:user_email] %></td>
          <% if show_error_type_count %>
            <td>
              <span class="badge bg-warning text-dark">
                <%= user_data[:error_type_count] %> types
              </span>
            </td>
          <% end %>
          <td>
            <span class="badge bg-danger"><%= user_data[:count] || user_data[:total_errors] %></span>
          </td>
          <% if show_percentage && total_errors.present? %>
            <td>
              <div class="progress" style="height: 20px;">
                <div class="progress-bar bg-danger"
                     role="progressbar"
                     style="width: <%= ((user_data[:count] || user_data[:total_errors]).to_f / total_errors * 100).round(1) %>%"
                     aria-valuenow="<%= user_data[:count] || user_data[:total_errors] %>"
                     aria-valuemin="0"
                     aria-valuemax="100">
                  <%= ((user_data[:count] || user_data[:total_errors]).to_f / total_errors * 100).round(1) %>%
                </div>
              </div>
            </td>
          <% end %>
          <% if show_error_types && user_data[:error_types].present? %>
            <td>
              <% user_data[:error_types].first(3).each do |error_type| %>
                <code class="small me-1"><%= error_type %></code>
              <% end %>
              <% if user_data[:error_types].count > 3 %>
                <span class="text-muted small">+<%= user_data[:error_types].count - 3 %> more</span>
              <% end %>
            </td>
          <% end %>
          <td>
            <%= link_to "View Errors", errors_path(user_id: user_data[:user_id]), class: "btn btn-sm btn-outline-primary" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
